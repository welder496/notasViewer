/*! notasViewer 19-11-2015 */
"use strict";window.setImmediate||(window.setImmediate=function(){return window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function(){if(!window.postMessage||!window.addEventListener)return null;var a=[void 0],b="zero-timeout-message",c=function(c){var d=a.length;return a.push(c),window.postMessage(b+d.toString(36),"*"),d};return window.addEventListener("message",function(c){if("string"==typeof c.data&&c.data.substr(0,b.length)===b){c.stopImmediatePropagation();var d=parseInt(c.data.substr(b.length),36);a[d]&&(a[d](),a[d]=void 0)}},!0),window.clearImmediate=function(b){a[b]&&(a[b]=void 0)},c}()||function(a){window.setTimeout(a,0)}}()),window.clearImmediate||(window.clearImmediate=function(){return window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function(a){window.clearTimeout(a)}}()),function(a){var b=function(){var a=document.createElement("canvas");if(!a||!a.getContext)return!1;var b=a.getContext("2d");return b.getImageData&&b.fillText&&Array.prototype.some&&Array.prototype.push?!0:!1}(),c=function(){if(b){for(var a,c,d=document.createElement("canvas").getContext("2d"),e=20;e;){if(d.font=e.toString(10)+"px sans-serif",d.measureText("Ｗ").width===a&&d.measureText("m").width===c)return e+1;a=d.measureText("Ｗ").width,c=d.measureText("m").width,e--}return 0}}(),d=function(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a},e=function(a,e){function f(a,b){return"hsl("+(360*Math.random()).toFixed()+","+(30*Math.random()+70).toFixed()+"%,"+(Math.random()*(b-a)+a).toFixed()+"%)"}if(b){Array.isArray(a)||(a=[a]),a.forEach(function(b,c){if("string"==typeof b){if(a[c]=document.getElementById(b),!a[c])throw"The element id specified is not found."}else if(!b.tagName&&!b.appendChild)throw"You must pass valid HTML elements, or ID of the element."});var g={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:!0,backgroundColor:"#fff",gridSize:8,origin:null,drawMask:!1,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,wait:0,abortThreshold:0,abort:function(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,shuffle:!0,rotateRatio:.1,shape:"circle",ellipticity:.65,hover:null,click:null};if(e)for(var h in e)h in g&&(g[h]=e[h]);if("function"!=typeof g.weightFactor){var i=g.weightFactor;g.weightFactor=function(a){return a*i}}if("function"!=typeof g.shape)switch(g.shape){case"circle":default:g.shape="circle";break;case"cardioid":g.shape=function(a){return 1-Math.sin(a)};break;case"diamond":case"square":g.shape=function(a){var b=a%(2*Math.PI/4);return 1/(Math.cos(b)+Math.sin(b))};break;case"triangle-forward":g.shape=function(a){var b=a%(2*Math.PI/3);return 1/(Math.cos(b)+Math.sqrt(3)*Math.sin(b))};break;case"triangle":case"triangle-upright":g.shape=function(a){var b=(a+3*Math.PI/2)%(2*Math.PI/3);return 1/(Math.cos(b)+Math.sqrt(3)*Math.sin(b))};break;case"pentagon":g.shape=function(a){var b=(a+.955)%(2*Math.PI/5);return 1/(Math.cos(b)+.726543*Math.sin(b))};break;case"star":g.shape=function(a){var b=(a+.955)%(2*Math.PI/10);return(a+.955)%(2*Math.PI/5)-2*Math.PI/10>=0?1/(Math.cos(2*Math.PI/10-b)+3.07768*Math.sin(2*Math.PI/10-b)):1/(Math.cos(b)+3.07768*Math.sin(b))}}g.gridSize=Math.max(Math.floor(g.gridSize),4);var j,k,l,m,n,o,p,q=g.gridSize,r=q-g.maskGapWidth,s=Math.abs(g.maxRotation-g.minRotation),t=Math.min(g.maxRotation,g.minRotation);switch(g.color){case"random-dark":p=function(){return f(10,50)};break;case"random-light":p=function(){return f(50,90)};break;default:"function"==typeof g.color&&(p=g.color)}var u,v=!1,w=[],x=function(a){var b=a.currentTarget,c=b.getBoundingClientRect(),d=a.clientX-c.left,e=a.clientY-c.top,f=Math.floor(d*(b.width/c.width||1)/q),g=Math.floor(e*(b.height/c.height||1)/q);return w[f][g]},y=function(a){var b=x(a);if(u!==b)return u=b,b?void g.hover(b.item,b.dimension,a):void g.hover(void 0,void 0,a)},z=function(a){var b=x(a);b&&g.click(b.item,b.dimension,a)},A=[],B=function(a){if(A[a])return A[a];var b=8*a,c=b,d=[];for(0===a&&d.push([m[0],m[1],0]);c--;){var e=1;"circle"!==g.shape&&(e=g.shape(c/b*2*Math.PI)),d.push([m[0]+a*e*Math.cos(-c/b*2*Math.PI),m[1]+a*e*Math.sin(-c/b*2*Math.PI)*g.ellipticity,c/b*2*Math.PI])}return A[a]=d,d},C=function(){return g.abortThreshold>0&&(new Date).getTime()-o>g.abortThreshold},D=function(){return 0===g.rotateRatio?0:Math.random()>g.rotateRatio?0:0===s?t:t+Math.random()*s},E=function(a,b,d){var e=!1,f=g.weightFactor(b);if(f<=g.minSize)return!1;var h=1;c>f&&(h=function(){for(var a=2;c>a*f;)a+=2;return a}());var i=document.createElement("canvas"),j=i.getContext("2d",{willReadFrequently:!0});j.font=g.fontWeight+" "+(f*h).toString(10)+"px "+g.fontFamily;var k=j.measureText(a).width/h,l=Math.max(f*h,j.measureText("m").width,j.measureText("Ｗ").width)/h,m=k+2*l,n=3*l,o=Math.ceil(m/q),p=Math.ceil(n/q);m=o*q,n=p*q;var r=-k/2,s=.4*-l,t=Math.ceil((m*Math.abs(Math.sin(d))+n*Math.abs(Math.cos(d)))/q),u=Math.ceil((m*Math.abs(Math.cos(d))+n*Math.abs(Math.sin(d)))/q),v=u*q,w=t*q;i.setAttribute("width",v),i.setAttribute("height",w),e&&(document.body.appendChild(i),j.save()),j.scale(1/h,1/h),j.translate(v*h/2,w*h/2),j.rotate(-d),j.font=g.fontWeight+" "+(f*h).toString(10)+"px "+g.fontFamily,j.fillStyle="#000",j.textBaseline="middle",j.fillText(a,r*h,(s+.5*f)*h);var x=j.getImageData(0,0,v,w).data;if(C())return!1;e&&(j.strokeRect(r*h,s,k*h,l*h),j.restore());for(var y,z,A,B=[],D=u,E=[t/2,u/2,t/2,u/2];D--;)for(y=t;y--;){A=q;a:{for(;A--;)for(z=q;z--;)if(x[4*((y*q+A)*v+(D*q+z))+3]){B.push([D,y]),D<E[3]&&(E[3]=D),D>E[1]&&(E[1]=D),y<E[0]&&(E[0]=y),y>E[2]&&(E[2]=y),e&&(j.fillStyle="rgba(255, 0, 0, 0.5)",j.fillRect(D*q,y*q,q-.5,q-.5));break a}e&&(j.fillStyle="rgba(0, 0, 255, 0.5)",j.fillRect(D*q,y*q,q-.5,q-.5))}}return e&&(j.fillStyle="rgba(0, 255, 0, 0.5)",j.fillRect(E[3]*q,E[0]*q,(E[1]-E[3]+1)*q,(E[2]-E[0]+1)*q)),{mu:h,occupied:B,bounds:E,gw:u,gh:t,fillTextOffsetX:r,fillTextOffsetY:s,fillTextWidth:k,fillTextHeight:l,fontSize:f}},F=function(a,b,c,d,e){for(var f=e.length;f--;){var g=a+e[f][0],h=b+e[f][1];if(g>=k||h>=l||0>g||0>h||!j[g][h])return!1}return!0},G=function(b,c,d,e,f,h,i,j,k){var l,m=d.fontSize;l=p?p(e,f,m,h,i):g.color;var n,o=d.bounds;n={x:(b+o[3])*q,y:(c+o[0])*q,w:(o[1]-o[3]+1)*q,h:(o[2]-o[0]+1)*q},a.forEach(function(a){if(a.getContext){var f=a.getContext("2d"),h=d.mu;f.save(),f.scale(1/h,1/h),f.font=g.fontWeight+" "+(m*h).toString(10)+"px "+g.fontFamily,f.fillStyle=l,f.translate((b+d.gw/2)*q*h,(c+d.gh/2)*q*h),0!==j&&f.rotate(-j),f.textBaseline="middle",f.fillText(e,d.fillTextOffsetX*h,(d.fillTextOffsetY+.5*m)*h),f.restore()}else{var i=document.createElement("span"),n="";n="rotate("+-j/Math.PI*180+"deg) ",1!==d.mu&&(n+="translateX(-"+d.fillTextWidth/4+"px) scale("+1/d.mu+")");var o={position:"absolute",display:"block",font:g.fontWeight+" "+m*d.mu+"px "+g.fontFamily,left:(b+d.gw/2)*q+d.fillTextOffsetX+"px",top:(c+d.gh/2)*q+d.fillTextOffsetY+"px",width:d.fillTextWidth+"px",height:d.fillTextHeight+"px",color:l,lineHeight:m+"px",whiteSpace:"nowrap",transform:n,webkitTransform:n,msTransform:n,transformOrigin:"50% 40%",webkitTransformOrigin:"50% 40%",msTransformOrigin:"50% 40%"};i.textContent=e;for(var p in o)i.style[p]=o[p];if(k)for(var r in k)i.setAttribute(r,k[r]);a.appendChild(i)}})},H=function(b,c,d,e,f){if(!(b>=k||c>=l||0>b||0>c)){if(j[b][c]=!1,d){var g=a[0].getContext("2d");g.fillRect(b*q,c*q,r,r)}v&&(w[b][c]={item:f,dimension:e})}},I=function(b,c,d,e,f,h){var i,j=f.occupied,k=g.drawMask;k&&(i=a[0].getContext("2d"),i.save(),i.fillStyle=g.maskColor);var l;if(v){var m=f.bounds;l={x:(b+m[3])*q,y:(c+m[0])*q,w:(m[1]-m[3]+1)*q,h:(m[2]-m[0]+1)*q}}for(var n=j.length;n--;)H(b+j[n][0],c+j[n][1],k,l,h);k&&i.restore()},J=function(a){var b,c,e;Array.isArray(a)?(b=a[0],c=a[1]):(b=a.word,c=a.weight,e=a.attributes);var f=D(),h=E(b,c,f);if(!h)return!1;if(C())return!1;var i=h.bounds;if(i[1]-i[3]+1>k||i[2]-i[0]+1>l)return!1;for(var j=n+1,m=function(d){var g=Math.floor(d[0]-h.gw/2),i=Math.floor(d[1]-h.gh/2),k=h.gw,l=h.gh;return F(g,i,k,l,h.occupied)?(G(g,i,h,b,c,n-j,d[2],f,e),I(g,i,k,l,h,a),!0):!1};j--;){var o=B(n-j);g.shuffle&&(o=[].concat(o),d(o));var p=o.some(m);if(p)return!0}return!1},K=function(b,c,d){return c?!a.some(function(a){var e=document.createEvent("CustomEvent");return e.initCustomEvent(b,!0,c,d||{}),!a.dispatchEvent(e)},this):void a.forEach(function(a){var e=document.createEvent("CustomEvent");e.initCustomEvent(b,!0,c,d||{}),a.dispatchEvent(e)},this)},L=function(){var b=a[0];if(b.getContext)k=Math.floor(b.width/q),l=Math.floor(b.height/q);else{var c=b.getBoundingClientRect();k=Math.floor(c.width/q),l=Math.floor(c.height/q)}if(K("wordcloudstart",!0)){m=g.origin?[g.origin[0]/q,g.origin[1]/q]:[k/2,l/2],n=Math.floor(Math.sqrt(k*k+l*l)),j=[];var d,e,f;if(!b.getContext||g.clearCanvas)for(a.forEach(function(a){if(a.getContext){var b=a.getContext("2d");b.fillStyle=g.backgroundColor,b.clearRect(0,0,k*(q+1),l*(q+1)),b.fillRect(0,0,k*(q+1),l*(q+1))}else a.textContent="",a.style.backgroundColor=g.backgroundColor}),d=k;d--;)for(j[d]=[],e=l;e--;)j[d][e]=!0;else{var h=document.createElement("canvas").getContext("2d");h.fillStyle=g.backgroundColor,h.fillRect(0,0,1,1);var i=h.getImageData(0,0,1,1).data,p=b.getContext("2d").getImageData(0,0,k*q,l*q).data;d=k;for(var r,s;d--;)for(j[d]=[],e=l;e--;){s=q;a:for(;s--;)for(r=q;r--;)for(f=4;f--;)if(p[4*((e*q+s)*k*q+(d*q+r))+f]!==i[f]){j[d][e]=!1;break a}j[d][e]!==!1&&(j[d][e]=!0)}p=h=i=void 0}if(g.hover||g.click){for(v=!0,d=k+1;d--;)w[d]=[];g.hover&&b.addEventListener("mousemove",y),g.click&&b.addEventListener("click",z),b.addEventListener("wordcloudstart",function F(){b.removeEventListener("wordcloudstart",F),b.removeEventListener("mousemove",y),b.removeEventListener("click",z),u=void 0})}f=0;var t,x;0!==g.wait?(t=window.setTimeout,x=window.clearTimeout):(t=window.setImmediate,x=window.clearImmediate);var A=function(b,c){a.forEach(function(a){a.addEventListener(b,c)},this)},B=function(b,c){a.forEach(function(a){a.removeEventListener(b,c)},this)},D=function G(){B("wordcloudstart",G),x(E)};A("wordcloudstart",D);var E=t(function H(){if(f>=g.list.length)return x(E),K("wordcloudstop",!1),void B("wordcloudstart",D);o=(new Date).getTime();var a=J(g.list[f]),b=!K("wordclouddrawn",!0,{item:g.list[f],drawn:a});return C()||b?(x(E),g.abort(),K("wordcloudabort",!1),K("wordcloudstop",!1),void B("wordcloudstart",D)):(f++,void(E=t(H,g.wait)))},g.wait)}};L()}};e.isSupported=b,e.miniumFontSize=c,"function"==typeof a.define&&a.define.amd?a.define("wordcloud",[],function(){return e}):"undefined"!=typeof a.module&&a.module.exports?a.module.exports=e:a.WordCloud=e}(window);